<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ProductCollection",
    "name": "{{ collection.title | escape }}",
    "description": "{{ collection.description | strip_html | escape }}",
    "keywords": "{{ data.keywords | escape }}",
    "provider": {
      "@type": "Organization",
      "name": "{{ shop.name | escape }}",
      "url": "{{ shop.url | escape }}"
    }{% if collection.products.size > 0 %},{% endif %}
    {% if collection.products.size > 0 %}"hasItem": [
    {% for product in collection.products %}
      {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "{{ product.title | strip_html | escape }}",
        "description": "{{ product.description | strip_html | escape }}",
        "image": [
          {% for image in product.images %}"https:{{ image.src | image_url }}"{% if forloop.last == false %},{% endif %}
          {% endfor %}
        ],
        "sku": "{{ product.variants.first.sku | escape }}",
        "mpn": "{{ product.variants.first.barcode | escape }}",
        "brand": {
          "@type": "Brand",
          {% if product.vendor %}"name": "{{ product.vendor | escape }}"{% else %}"name": "{{ org_data.brand.name | escape }}"{% endif %}
        },
        {% if product.metafields['bs-23-seo-app']['json-ld'].value != null %}"aggregateRating": {
          "@type": "AggregateRating",
          "itemReviewed": {
            "@type": "Thing",
            "name": "{{ product.title | strip_html | escape }}"
          },
          "ratingValue": {{ product_meta_data.product.rating }},
          "reviewCount": {{ product_meta_data.product.reviewCount }}
        },{% endif %}
        "offers": [
        {% for variant in product.variants %}{
            "@type": "Offer",
            "priceCurrency": "{{ shop.currency | escape }}",
            "price": {{ variant.price | money_without_currency | remove: ',' }},
            "availability": "{% if variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
            "sku": "{{ variant.sku | escape }}",
            "mpn": "{{ variant.barcode | escape }}",
            "url": "{{ shop.url }}/products/{{ product.handle }}?variant={{ variant.id }}",
            "seller": {
              "@type": "Organization",
              "name": "{{ shop.name | escape }}",
              "url": "{{ shop.url | escape }}"
            }
          }{% if forloop.last == false %},{% endif %}{% endfor %}
        ]
      }{% if forloop.last == false %},{% endif %}{% endfor %}
    ]{% endif %}
  }
</script>
