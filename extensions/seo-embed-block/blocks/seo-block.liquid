{% comment %} <script async src="https://unpkg.com/deepmerge@4.3.1/dist/umd.js"></script> {% endcomment %}
<script async>
  console.log('start');
</script>
{% assign shop_data = shop.metafields['bs-23-seo-app']['json-ld'].value %}

{% if shop_data != null and shop_data.organization.status %}
  {% render 'organization', data: shop_data.organization %}
{% endif %}

{% if request.page_type == 'product' %}
  {% assign data = product.metafields['bs-23-seo-app']['json-ld'].value %}
  {% if data != null and data.active %}
    {% render 'product', org_data: shop_data.organization, data: data.product %}
  {% endif %}
{% elsif request.page_type == 'collection' %}
  {% assign data = collection.metafields['bs-23-seo-app']['json-ld'].value %}
  {% if data != null and data.active %}
    {% render 'collection', org_data: shop_data.organization, data: data.collection %}
  {% endif %}
{% elsif request.page_type == 'blog' %}
  {% assign data = collection.metafields['bs-23-seo-app']['json-ld'].value %}
  {% if data != null and data.active %}
    {% render 'blog', org_data: shop_data.organization, data: data.collection %}
  {% endif %}
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    let pageType = '{{ request.page_type }}';
    if (pageType == 'index') {
      var seoTitle = "{{ shop.metafields['seo-app-bs23']['home-seo-value'].value.seo_title }}";
      var seoDescription = "{{ shop.metafields['seo-app-bs23']['home-seo-value'].value.seo_description }}";

      if (seoTitle) {
        document.title = seoTitle;
      }

      if (seoDescription) {
        var metaDescription = document.querySelector('meta[name="description"]');
        if (metaDescription) {
          metaDescription.setAttribute('content', seoDescription);
        } else {
          var newMetaDescription = document.createElement('meta');
          newMetaDescription.name = 'description';
          newMetaDescription.content = seoDescription;
          document.head.appendChild(newMetaDescription);
        }
      }
    } else if (pageType === 'article') {
      var seoTitle = "{{ article.metafields['seo-app-bs23']['seo-blog-article'].value.seoTitle }}";
      var seoDescription = "{{ article.metafields['seo-app-bs23']['seo-blog-article'].value.seoDescription }}";

      if (seoTitle) {
        document.title = seoTitle;
      }

      if (seoDescription) {
        var metaDescription = document.querySelector('meta[name="description"]');
        if (metaDescription) {
          metaDescription.setAttribute('content', seoDescription);
        } else {
          var newMetaDescription = document.createElement('meta');
          newMetaDescription.name = 'description';
          newMetaDescription.content = seoDescription;
          document.head.appendChild(newMetaDescription);
        }
      }
    }
  });
</script>

{% schema %}
{
  "name": "SEO app",
  "target": "head"
}
{% endschema %}
